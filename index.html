const tmdbKey="179d23dc4b4a1ba27263fcc2503d5e3d";
const footKey="f1637751ac2e41dc8cfbe1f9492c0a4b";

<!doctype html><html lang="pl"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Date Info Bar â€“ External Namesday.js</title>
<style>
body{margin:0;font:15px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial}
#top{position:fixed;top:0;left:0;right:0;z-index:2147483647;background:#111827;color:#F9FAFB;
     box-shadow:0 4px 12px rgba(0,0,0,.25);padding:10px 14px;font-size:15px;
     border-bottom:2px solid #374151}
h2{margin:6px 0;font-size:15px;color:#60A5FA}
a{color:#F9FAFB;text-decoration:none;font-weight:600}
.mut{color:#9CA3AF}
#close{position:absolute;right:10px;top:8px;border:0;background:#374151;color:#E5E7EB;
        border-radius:8px;padding:2px 8px;font-size:16px;cursor:pointer}
#sp{height:auto;padding-top:220px}
</style>

<div id="top">
  <button id="close">Ã—</button>
  <div id="d"></div>
  <div id="nd"><h2>Imieniny (PL)</h2><div class="mut">loadingâ€¦</div></div>
  <div id="otd"><h2>On this day</h2><div class="mut">loadingâ€¦</div></div>
  <div id="mv"><h2>Movies</h2><div class="mut">loadingâ€¦</div></div>
  <div id="al"><h2>Albums</h2><div class="mut">loadingâ€¦</div></div>
  <div id="ft"><h2>Matches</h2><div class="mut">loadingâ€¦</div></div>
</div>
<div id="sp"></div>

<script>
(async()=>{
const tmdbKey="179d23dc4b4a1ba27263fcc2503d5e3d";
const footKey="f1637751ac2e41dc8cfbe1f9492c0a4b";                

const today=new Date(),
ymd=today.toISOString().slice(0,10),
MM=('0'+(today.getMonth()+1)).slice(-2),
DD=('0'+today.getDate()).slice(-2);
const $=id=>document.getElementById(id),set=(id,html)=>($(id).innerHTML=html);
$("d").innerHTML=`ðŸ“… ${ymd} (${today.toLocaleDateString('pl-PL',{weekday:'long'})})`;

// ðŸ”¹ Names-day (load from external file)
(async()=>{
 try {
   const s=document.createElement("script");
   s.src="https://cdn.jsdelivr.net/gh/aceg-pl/dd/namesday.js";
   s.async=true;
   s.onload=()=>{
     let names="";
     try{
       if(window.PobierzImieniny) names=window.PobierzImieniny();
       set("nd",`<h2>Imieniny (PL)</h2>${names||"<span class='mut'>none</span>"}`);
     }catch(e){
       set("nd","<h2>Imieniny (PL)</h2><span class='mut'>function error</span>");
     }
   };
   s.onerror=()=>set("nd","<h2>Imieniny (PL)</h2><span class='mut'>load error</span>");
   document.head.appendChild(s);
 } catch(e){
   set("nd","<h2>Imieniny (PL)</h2><span class='mut'>load failed</span>");
 }
})();

// utility
const j=async(u,o)=>{try{const r=await fetch(u,o);if(!r.ok)throw 0;return await r.json()}catch(e){return null}}
const bullets=(arr,max=8,map=x=>x)=>arr&&arr.length?arr.slice(0,max).map(map).join(" â€¢ "):"<span class='mut'>none</span>";

// ðŸ”¹ On this day (sorted oldestâ†’newest, top 5, year bolded)
j(`https://api.wikimedia.org/feed/v1/wikipedia/en/onthisday/all/${MM}/${DD}`).then(d=>{
 let ev=(d&&d.events)?d.events.sort((a,b)=>a.year-b.year).slice(0,5):[];
 const html=ev.map(x=>`<b>${x.year}</b>: <a href="https://en.wikipedia.org/wiki/${encodeURIComponent((x.pages?.[0]?.titles?.normalized)||'')}" target="_blank">${x.text.split(" â€“ ")[0]}</a>`).join("<br>");
 set("otd",`<h2>On this day</h2>${html||"<span class='mut'>none</span>"}`);
});

// ðŸ”¹ Movies (bold + extended)
(async()=>{
 if(!tmdbKey){set("mv","<h2>Movies</h2><span class='mut'>add TMDb key</span>");return;}
 const d=await j(`https://api.themoviedb.org/3/discover/movie?api_key=${tmdbKey}&language=en-US&region=US&with_release_type=3|2&primary_release_date.gte=${ymd}&primary_release_date.lte=${ymd}&sort_by=popularity.desc`);
 if(!d||!d.results){set("mv","<h2>Movies</h2><span class='mut'>none</span>");return;}
 const movies=d.results.slice(0,8);
 const infos=[];
 for(const m of movies){
   const det=await j(`https://api.themoviedb.org/3/movie/${m.id}?api_key=${tmdbKey}&append_to_response=credits`);
   if(!det)continue;
   const genres=(det.genres||[]).map(g=>g.name).join(", ");
   const dir=(det.credits.crew.find(c=>c.job=="Director")||{}).name||"";
   const cast=(det.credits.cast||[]).slice(0,3).map(c=>c.name).join(", ");
   infos.push(`<a href="https://www.themoviedb.org/movie/${m.id}" target="_blank"><b>${m.title}</b></a>${genres?", "+genres:""}${dir?", "+dir:""}${cast?", "+cast:""}`);
 }
 set("mv",`<h2>Movies</h2>${infos.length?infos.join(" â€¢ "):"<span class='mut'>none</span>"}`);
})();

// ðŸ”¹ Albums (bold + artists)
j(`https://musicbrainz.org/ws/2/release/?query=date:${ymd}%20AND%20status:official&fmt=json&limit=15`).then(d=>{
 const seen=new Set,releases=(d&&d.releases||[]).filter(x=>{
   const t=(x["release-group"]?.title)||x.title;
   if(seen.has(t))return false; seen.add(t); return t;
 });
 const html=bullets(releases,10,x=>{
   const t=(x["release-group"]?.title)||x.title;
   const id=(x["release-group"]?.id)||x.id;
   const artists=(x["artist-credit"]||[]).map(a=>a.name).join(", ");
   return `<a href="https://musicbrainz.org/release-group/${id}" target="_blank"><b>${t}</b></a>${artists?", "+artists:""}`;
 });
 set("al",`<h2>Albums</h2>${html}`);
});

// ðŸ”¹ Matches
(async()=>{
 if(!footKey){set("ft","<h2>Matches</h2><span class='mut'>add football key</span>");return;}
 const d=await j(`https://api.football-data.org/v4/matches?dateFrom=${ymd}&dateTo=${ymd}&competitions=PD,CL`,
                 {headers:{"X-Auth-Token":footKey}});
 const matches=(d&&d.matches)||[];
 const html=matches.length?matches.slice(0,10).map(m=>`${m.competition.code||m.competition.name}: ${m.homeTeam.name} vs ${m.awayTeam.name} ${(m.utcDate||"").slice(11,16)} UTC`).join("<br>"):"<span class='mut'>none</span>";
 set("ft",`<h2>Matches</h2>${html}`);
})();

// Close button
document.getElementById("close").onclick=()=>{document.getElementById("top").remove();};
})();
</script>
</html>
